version: '3.8'

services:
    app:
        build:
            context: .
            dockerfile: Dockerfile
        image: nextflix-backend-api-service:latest
        ports:
            - '3000:3000'
        environment:
            - NODE_ENV=production
        restart: unless-stopped
        # For local development you can enable the volume mapping below.
        # Remove or comment this in production to use the built image contents.
        volumes:
            - ./:/app:cached
        command: ['node', 'dist/main']
        healthcheck:
            test: ['CMD-SHELL', 'curl -f http://localhost:3000/health || exit 1']
            interval: 30s
            timeout: 5s
            retries: 3
